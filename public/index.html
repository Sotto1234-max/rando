<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat WebApp</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Login Form -->
  <div id="login" class="flex items-center justify-center h-screen">
    <div class="bg-white shadow-md p-8 rounded-lg w-full max-w-md">
      <h2 class="text-2xl font-bold mb-4 text-center">Login</h2>
      <input id="name" type="text" placeholder="Name" class="w-full mb-2 px-4 py-2 border rounded"/>
      <input id="age" type="number" placeholder="Age" class="w-full mb-2 px-4 py-2 border rounded"/>
      <select id="gender" class="w-full mb-2 px-4 py-2 border rounded">
        <option value="">Select Gender</option>
        <option value="male">Male</option>
        <option value="female">Female</option>
      </select>
      <input id="photo" type="file" accept="image/*" class="w-full mb-4"/>
      <button onclick="login()" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Login</button>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" class="hidden h-screen flex flex-col">

    <!-- User Panel (Header + User List) -->
    <div id="user-panel" class="flex-1 flex flex-col">
      <!-- Header -->
      <div class="bg-white shadow p-4 flex items-center justify-between">
        <div>
          <button onclick="filterUsers('all')" class="mr-2 text-blue-500">All</button>
          <button onclick="filterUsers('male')" class="mr-2 text-blue-500">Male</button>
          <button onclick="filterUsers('female')" class="text-blue-500">Female</button>
          <button onclick="showInbox()" class="ml-6 text-green-600">Inbox</button>
        </div>
        <div class="flex items-center gap-2">
          <img id="user-photo" class="w-8 h-8 rounded-full"/>
          <span id="user-name" class="font-medium"></span>
        </div>
      </div>

      <!-- User List -->
      <div id="user-list" class="w-full flex-1 bg-white p-4 overflow-y-auto border-t">
        <!-- Users will be dynamically added here -->
      </div>
    </div>

    <!-- Chat Body -->
    <div id="chat-body" class="hidden absolute inset-0 flex flex-col bg-gray-50">
      <div class="flex items-center justify-between bg-white p-3 border-b">
        <div class="flex items-center gap-2">
          <img id="chat-user-photo" class="w-8 h-8 rounded-full"/>
          <span id="chat-user-name" class="font-semibold"></span>
        </div>
        <div class="flex items-center gap-2">
  <button class="text-green-600 font-semibold border border-green-500 px-3 py-1 rounded hover:bg-green-50">Video Call</button>
  <button onclick="closeChat()" class="text-red-500 text-lg font-bold">X</button>
</div>
      </div>
      <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-2">
        <!-- Messages appear here -->
      </div>
      <div class="p-3 border-t flex gap-2 items-center bg-white">
        <input id="message-input" type="text" placeholder="Type a message" class="flex-1 border px-4 py-2 rounded"/>
        <input id="image-input" type="file" accept="image/*" class="hidden" />
        <button onclick="document.getElementById('image-input').click()" class="text-blue-500">ðŸ“·</button>
        <button onclick="sendMessage()" class="bg-blue-500 text-white px-4 py-2 rounded">Send</button>
      </div>
    </div>

  </div>

  <script>
    let currentUser = null;
    let selectedUser = null;
    const users = [];
    const messages = {};

    function login() {
      const name = document.getElementById('name').value;
      const age = document.getElementById('age').value;
      const gender = document.getElementById('gender').value;
      const photo = document.getElementById('photo').files[0];

      if (!name || !age || !gender || !photo) {
        alert('Please fill out all fields.');
        return;
      }

      const reader = new FileReader();
      reader.onload = () => {
        currentUser = { name, age, gender, photo: reader.result };
        document.getElementById('user-name').textContent = name;
        document.getElementById('user-photo').src = reader.result;

        document.getElementById('login').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');

        users.push(currentUser);
        addDummyUsers();
        renderUsers();
      };
      reader.readAsDataURL(photo);
    }

    function addDummyUsers() {
      const dummy = [
        { name: 'Anik', gender: 'male', photo: 'https://i.pravatar.cc/150?img=10' },
        { name: 'Lima', gender: 'female', photo: 'https://i.pravatar.cc/150?img=20' },
        { name: 'Jamal', gender: 'male', photo: 'https://i.pravatar.cc/150?img=30' },
        { name: 'Tania', gender: 'female', photo: 'https://i.pravatar.cc/150?img=40' }
      ];
      users.push(...dummy);
      dummy.forEach(user => {
        messages[user.name] = [];
      });
    }

    function renderUsers(filter = 'all') {
      const list = document.getElementById('user-list');
      list.innerHTML = '';
      users.forEach(user => {
        if (user.name === currentUser.name) return;
        if (filter !== 'all' && user.gender !== filter) return;

        const unread = messages[user.name]?.some(msg => !msg.read);
        list.innerHTML += `
          <div onclick="openChat('${user.name}')" class="cursor-pointer p-2 hover:bg-gray-100 flex items-center gap-3">
            <img src="${user.photo}" class="w-10 h-10 rounded-full"/>
            <span class="flex-1">${user.name}</span>
            ${unread ? '<span class="w-3 h-3 bg-blue-500 rounded-full"></span>' : ''}
          </div>
        `;
      });
    }

    const socket = io();

// After login:
socket.emit('login', currentUser);

// To send message:
socket.emit('sendMessage', { from: currentUser.name, to: selectedUser.name, text: 'Hello!' });

// To receive:
socket.on('receiveMessage', (msg) => {
  // Show message in chat
});

// To update user list:
socket.on('userList', (userList) => {
  // Render user list dynamically
});


    function filterUsers(type) {
      renderUsers(type);
    }

    function showInbox() {
      const list = document.getElementById('user-list');
      list.innerHTML = '';
      for (let name in messages) {
        const user = users.find(u => u.name === name);
        const unread = messages[name].some(m => !m.read);
        list.innerHTML += `
          <div onclick="openChat('${name}')" class="cursor-pointer p-2 hover:bg-gray-100 flex items-center gap-3">
            <img src="${user.photo}" class="w-10 h-10 rounded-full"/>
            <span class="flex-1">${name}</span>
            ${unread ? '<span class="w-3 h-3 bg-blue-500 rounded-full"></span>' : ''}
          </div>
        `;
      }
    }

    function openChat(userName) {
      selectedUser = users.find(u => u.name === userName);
      document.getElementById('chat-user-name').textContent = selectedUser.name;
      document.getElementById('chat-user-photo').src = selectedUser.photo;

      document.getElementById('user-panel').classList.add('hidden');
      document.getElementById('chat-body').classList.remove('hidden');

      messages[userName]?.forEach(msg => msg.read = true);
      renderMessages();
    }

    function renderMessages() {
      const box = document.getElementById('chat-messages');
      box.innerHTML = '';
      const chat = messages[selectedUser.name] || [];
      chat.forEach(msg => {
        const align = msg.from === currentUser.name ? 'justify-end text-right' : 'justify-start text-left';
        const color = msg.from === currentUser.name ? 'bg-blue-100' : 'bg-gray-200';
        box.innerHTML += `
          <div class="flex ${align}">
            <div class="${color} p-2 rounded max-w-xs">
              ${msg.image ? `<img src="${msg.image}" class="max-w-full mb-1"/>` : ''}
              ${msg.text || ''}
            </div>
          </div>
        `;
      });
      box.scrollTop = box.scrollHeight;
    }

    document.getElementById('image-input').addEventListener('change', function () {
      const file = this.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        messages[selectedUser.name].push({ from: currentUser.name, image: reader.result, read: true });
        renderMessages();
      };
      reader.readAsDataURL(file);
    });

    function sendMessage() {
      const input = document.getElementById('message-input');
      const text = input.value.trim();
      if (!text) return;
      if (!messages[selectedUser.name]) messages[selectedUser.name] = [];

      messages[selectedUser.name].push({ from: currentUser.name, text, read: true });
      input.value = '';
      renderMessages();
    }

    function closeChat() {
      document.getElementById('chat-body').classList.add('hidden');
      document.getElementById('user-panel').classList.remove('hidden');
      renderUsers();
    }
  </script>
  <script src="/socket.io/socket.io.js"></script>
</body>
</html>
