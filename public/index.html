<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Random Chat</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src='//whephiwums.com/sdk.js' data-zone='9229076' data-sdk='show_9229076'></script>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Login Form -->
  <!-- Login Form -->
<div id="login" class="flex items-center justify-center min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
  <div class="bg-white shadow-lg p-8 rounded-3xl w-full max-w-md">
    <h2 class="text-3xl font-semibold mb-6 text-center text-indigo-600">Login</h2>
    
    <input id="name" type="text" placeholder="Your Name" class="w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" />
    
    <input id="age" type="number" placeholder="Your Age" class="w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" />
    
    <select id="gender" class="w-full mb-4 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition">
      <option value="">Select Gender</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
    
    <input id="photo" type="file" accept="image/*" class="w-full mb-6 p-2 border border-gray-300 rounded-lg bg-gray-50 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" />
    
    <button onclick="login()" class="bg-indigo-600 text-white px-6 py-3 rounded-xl w-full text-lg font-semibold shadow-md hover:bg-indigo-500 transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-indigo-500">Login</button>
  </div>
</div>


  <!-- Main App -->
  <div id="app" class="hidden h-screen flex flex-col">

    <!-- User Panel (Header + User List) -->
    <div id="user-panel" class="flex-1 flex flex-col">
      <!-- Header -->
      <div class="bg-white shadow p-4 flex items-center justify-between">
        <div>
          <button onclick="filterUsers('all')" class="mr-2 text-blue-500">üåêAll</button>
          <button onclick="filterUsers('male')" class="mr-2 text-blue-500">üë®‚Äçü¶±Male</button>
          <button onclick="filterUsers('female')" class="text-blue-500">üë©Female</button>
          <button onclick="showInbox()" class="ml-6 text-green-600">üì•Inbox</button>
        </div>
        <div class="flex items-center gap-2">
          <img id="user-photo" class="w-8 h-8 rounded-full"/>
          <span id="user-name" class="font-medium"></span>
        </div>
      </div>

      <!-- User List -->
      <div id="user-list" class="w-full flex-1 bg-white p-4 overflow-y-auto border-t">
        <!-- Users will be dynamically added here -->
      </div>
    </div>

    <!-- Chat Body -->
    <div id="chat-body" class="hidden absolute inset-0 flex flex-col bg-gray-50">
      <div class="flex items-center justify-between bg-white p-3 border-b">
        <div class="flex items-center gap-2">
          <img id="chat-user-photo" class="w-8 h-8 rounded-full"/>
          <span id="chat-user-name" class="font-semibold"></span>
        </div>
        <div class="flex items-center gap-2">
          <button class="text-green-600 font-semibold border border-green-500 px-3 py-1 rounded hover:bg-green-50" onclick="show_9229076().then(() => {
    window.open('https://www.febspot.com/auth/google/?ref=725136', '_blank');
    alert('Sign in with Gmail to start video chat');
  })">Video Call</button>
          <button onclick="closeChat()" class="text-red-500 text-lg font-bold">X</button>
        </div>
      </div>
      <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-2"></div>
      <div class="p-3 border-t flex gap-2 items-center bg-white">
        <input id="message-input" type="text" placeholder="Type a message" class="flex-1 border px-4 py-2 rounded"/>
        <input id="image-input" type="file" accept="image/*" class="hidden" />
        <button onclick="document.getElementById('image-input').click()" class="text-blue-500">üì∑</button>
        <button onclick="sendThenShowAd()" class="bg-blue-500 text-white px-4 py-2 rounded">Send</button>
      </div>
    </div>

  </div>


<script src="/socket.io/socket.io.js"></script>
<script>
  let currentUser = null;
  let selectedUser = null;
  const users = [];
  const messages = {};

  const socket = io();

  function login() {
  const name = document.getElementById('name').value;
  const age = document.getElementById('age').value;
  const gender = document.getElementById('gender').value;
  const photo = document.getElementById('photo').files[0];

  if (!name || !age || !gender) {
    alert('Please fill out all fields.');
    return;
  }

  const reader = new FileReader();

  if (photo) {
    reader.onload = () => {
      currentUser = { name, age, gender, photo: reader.result };
      finalizeLogin();
    };
    reader.readAsDataURL(photo);
  } else {
    currentUser = { name, age, gender, photo: '' };
    finalizeLogin();
  }

  function finalizeLogin() {
    document.getElementById('user-name').textContent = name;
    document.getElementById('user-photo').src = currentUser.photo || 'https://via.placeholder.com/40';
    document.getElementById('login').classList.add('hidden');
    document.getElementById('app').classList.remove('hidden');

    socket.emit('login', currentUser);
    //addDummyUsers();
    renderUsers();
  }
}


  function addDummyUsers() {
    const dummy = [
      { name: 'Anik', gender: 'male', photo: 'https://i.pravatar.cc/150?img=10' },
      { name: 'Lima', gender: 'female', photo: 'https://i.pravatar.cc/150?img=20' },
      { name: 'Jamal', gender: 'male', photo: 'https://i.pravatar.cc/150?img=30' },
      { name: 'Tania', gender: 'female', photo: 'https://i.pravatar.cc/150?img=40' }
    ];
    users.push(...dummy);
    dummy.forEach(user => {
      messages[user.name] = [];
    });
  }

  function renderUsers(filter = 'all') {
    const list = document.getElementById('user-list');
    list.innerHTML = '';
    users.forEach(user => {
      if (user.name === currentUser.name) return;
      if (filter !== 'all' && user.gender !== filter) return;

      const unread = messages[user.name]?.some(msg => !msg.read);
      list.innerHTML += `
  <div onclick="openChat('${user.name}')" class="flex items-center justify-between p-3 bg-white rounded-lg shadow hover:shadow-md transition cursor-pointer">
    <div class="flex items-center gap-3">
      <img src="${user.photo}" class="w-12 h-12 rounded-full object-cover border" />
      <div>
        <p class="text-gray-800 font-medium">${user.name}</p>
        <p class="text-sm text-gray-500 capitalize">${user.gender}</p>
      </div>
    </div>
    ${unread ? '<span class="w-3 h-3 bg-blue-500 rounded-full animate-ping"></span>' : ''}
  </div>
`;

    });
  }

  socket.on('receiveMessage', (msg) => {
    if (!messages[msg.from]) messages[msg.from] = [];
    msg.read = false;
    messages[msg.from].push(msg);

    if (selectedUser && selectedUser.name === msg.from) {
      msg.read = true;
      renderMessages();
    } else {
      renderUsers();
    }
  });

  socket.on('userList', (userList) => {
    users.length = 0;
    users.push(...userList);
    renderUsers();
  });

  function filterUsers(type) {
    renderUsers(type);
  }

  function showInbox() {
    const list = document.getElementById('user-list');
    list.innerHTML = '';

    for (let name in messages) {
      const user = users.find(u => u.name === name);
      if (!user) continue;
      const unread = messages[name].some(m => !m.read);
      list.innerHTML += `
        <div onclick="openChat('${name}')" class="cursor-pointer p-2 hover:bg-gray-100 flex items-center gap-3">
          <img src="${user.photo}" class="w-10 h-10 rounded-full"/>
          <span class="flex-1">${name}</span>
          ${unread ? '<span class="w-3 h-3 bg-blue-500 rounded-full"></span>' : ''}
        </div>
      `;
    }
  }

  function openChat(userName) {
    selectedUser = users.find(u => u.name === userName);
    document.getElementById('chat-user-name').textContent = selectedUser.name;
    document.getElementById('chat-user-photo').src = selectedUser.photo;

    document.getElementById('user-panel').classList.add('hidden');
    document.getElementById('chat-body').classList.remove('hidden');

    messages[userName]?.forEach(msg => msg.read = true);
    renderMessages();
  }

  function renderMessages() {
    const box = document.getElementById('chat-messages');
    box.innerHTML = '';
    const chat = messages[selectedUser.name] || [];
    chat.forEach(msg => {
      const align = msg.from === currentUser.name ? 'justify-end text-right' : 'justify-start text-left';
      const color = msg.from === currentUser.name ? 'bg-blue-100' : 'bg-gray-200';
      box.innerHTML += `
        <div class="flex ${align}">
          <div class="${color} p-2 rounded max-w-xs">
            ${msg.image ? `<img src="${msg.image}" class="max-w-full mb-1"/>` : ''}
            ${msg.text || ''}
          </div>
        </div>
      `;
    });
    box.scrollTop = box.scrollHeight;
  }

  document.getElementById('image-input').addEventListener('change', function () {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      const imageMsg = { from: currentUser.name, to: selectedUser.name, image: reader.result, read: true };
      if (!messages[selectedUser.name]) messages[selectedUser.name] = [];
      messages[selectedUser.name].push(imageMsg);
      renderMessages();
      socket.emit('sendMessage', imageMsg);
    };
    reader.readAsDataURL(file);
  });

  function sendMessage() {
    const input = document.getElementById('message-input');
    const text = input.value.trim();
    if (!text) return;
    if (!messages[selectedUser.name]) messages[selectedUser.name] = [];

    const msg = { from: currentUser.name, to: selectedUser.name, text, read: true };
    messages[selectedUser.name].push(msg);
    input.value = '';
    renderMessages();
    socket.emit('sendMessage', msg);
  }

  function closeChat() {
    document.getElementById('chat-body').classList.add('hidden');
    document.getElementById('user-panel').classList.remove('hidden');
    renderUsers();
  }
</script>
  <script> function handleBotMessages(user, socket) {
  const isMale = user.gender === 'male';
  const botGroup = isMale ? femaleBots : maleBots;

  // Randomly select 4‚Äì5 bots
  const botsToMessage = botGroup.sort(() => 0.5 - Math.random()).slice(0, 5);

  botsToMessage.forEach((bot, index) => {
    const delay = Math.floor(Math.random() * 10000) + 10000; // 10‚Äì20s

    setTimeout(() => {
      const message = botMessages[Math.floor(Math.random() * botMessages.length)];

      const msg = {
        from: bot.name,
        to: user.name,
        text: message,
        read: false
      };

      // Save in memory (optional, handled on frontend too)
      // Send message to real user
      io.to(user.id).emit('receiveMessage', msg);
    }, delay + index * 1000); // stagger slightly to avoid exact same timestamp
  });
}
 </script>
  <script src="https://cdn.adsgram.io/ads.js"></script>
<script>
  let AdController;

  // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶≤‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡ßü‡¶æ‡¶≤‡¶æ‡¶á‡¶ú ‡¶ï‡¶∞‡ßã
  window.onload = async function () {
    try {
      AdController = window.Adsgram.init({
        blockId: "int-10200" // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ block ID ‡¶¨‡¶∏‡¶æ‡¶ì
      });
    } catch (err) {
      console.log("Ad init failed:", err);
    }
  };

  // ‡¶è‡¶á ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶æ ‡¶¨‡¶æ‡¶ü‡¶®‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶ï‡¶≤ ‡¶π‡¶¨‡ßá
  async function sendThenShowAd() {
    // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶ì
    sendMessage();

    // ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶ì
    try {
      if (AdController) {
        await AdController.show(); // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
      }
    } catch (err) {
      console.log("Ad failed to show:", err);
    }
  }

  // ‡¶§‡ßã‡¶∞ ‡¶Ü‡¶∏‡¶≤ send() ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  function send() {
    console.log("Message sent!");
    // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßÅ‡¶á ‡¶Ø‡ßá‡¶ü‡¶æ ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡¶ø‡¶∏ ‡¶¨‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶∏, ‡¶∏‡ßá‡¶ü‡¶æ ‡¶¨‡¶∏‡¶æ‡¶¨‡¶ø
    // ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£: socket.emit('send-message', { to: 'User', message: 'Hello!' });
  }
</script>
</body>
</html>
